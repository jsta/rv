<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>rv: a simulation-based random variable class • rv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="rv: a simulation-based random variable class">
<meta property="og:description" content="rv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rv-doc.html">rv: a simulation-based random variable class</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jsta/rv/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rv-doc_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>rv: a simulation-based random variable class</h1>
                        <h4 data-toc-skip class="author">Jouni Kerman</h4>
            
            <h4 data-toc-skip class="date">2022-02-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jsta/rv/blob/HEAD/vignettes/rv-doc.Rmd" class="external-link"><code>vignettes/rv-doc.Rmd</code></a></small>
      <div class="hidden name"><code>rv-doc.Rmd</code></div>

    </div>

    
    
<p><em>Edited by Jemma Stachelek: 12 February, 2022</em></p>

<p><code>rv</code> is an implementation of a simulation-based random variable object class for R, originally introduced in <span class="citation">Kerman and Gelman (2007)</span>.</p>
<p><code>rv</code> implements a new class of vectors that contain a ‘hidden dimension’ of simulations in each scalar component. These <code>rv objects</code> can be manipulated much like any numeric vectors, but the arithmetic operations are performed on the simulations, and summaries are calculated from the simulation vectors.</p>
<p><code>rv</code> is convenient for manipulating posterior simulations obtained from MCMC samplers, for example using Umacs <span class="citation">(Kerman 2005)</span> or R2WinBUGS <span class="citation">(Sturtz, Ligges, and Gelman 2005)</span> (the package provides a coercion method to convert <code>bugs</code> objects to <code>rv</code> objects.)</p>
<p>The paper by <span class="citation">Kerman and Gelman (2007)</span> introduces the principles of the design of random variable objects. This document is a short overview of some of the commands provided by the package <code>rv</code>. At the end of the document there is a short description of the implementation.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Install the package <code>rv</code> (version 2.1.1 or higher) using the Package Installer command in R (from the menu), and load the package using,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jsta/rv" class="external-link">rv</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-quick-tour">A quick tour<a class="anchor" aria-label="anchor" href="#a-quick-tour"></a>
</h2>
<p>The rv objects (or, “random vectors”) that we manipulate usually come from a Markov chain sampler. To introduce some commands quickly, we will instead use some random vectors generated by <em>random-vector generating functions</em> which sample directly from a given (standard) distribution.</p>
<div class="section level4">
<h4 id="number-of-simulations-">Number of simulations.<a class="anchor" aria-label="anchor" href="#number-of-simulations-"></a>
</h4>
<p>First, we will set the number of simulations we use. We choose 4000 simulations per each scalar component of a random vector:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvnsims.html">setnsims</a></span><span class="op">(</span><span class="fl">4000</span><span class="op">)</span>
<span class="co">#&gt; [1] 4000</span></code></pre></div>
<p>We will not usually change this value during our session, unless we want to repeat our analysis with more (or fewer) simulations. The default value is 4000, set whenever the package is loaded for the first time in the workspace; therefore this is not strictly a necessary step to do every time we start the package.</p>
</div>
<div class="section level4">
<h4 id="a-normally-distributed-random-vector">A Normally distributed random vector<a class="anchor" aria-label="anchor" href="#a-normally-distributed-random-vector"></a>
</h4>
<p>To draw a random Gaussian (Normal) vector of length 5 with corresponding means <span class="math inline">\(1,2,3,4,5\)</span> and s.d. 1,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>In effect, the object <code>x</code> now contains five vectors of length <span class="math inline">\(4000\)</span>, drawn (internally) using <code>rnorm</code>, but we see <code>x</code> as a <em>vector of length 5</em>.</p>
<p>The length of the vector is derived from the length of the mean vector (and the sd vector), and it is not necessary to specify a parameter “<code>n</code>”.</p>
</div>
<div class="section level4">
<h4 id="quick-distribution-summary">Quick distribution summary<a class="anchor" aria-label="anchor" href="#quick-distribution-summary"></a>
</h4>
<p>To summarize the distribution of <code>x</code> by viewing quantiles, means, and s.d.’s, we only type the name of the object at the console:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span>
<span class="co">#&gt;     mean   sd    1%   2.5%  25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] 0.98 0.98 -1.35 -0.926 0.31   1 1.7   2.9 3.2 4000</span>
<span class="co">#&gt; [2] 1.98 1.01 -0.40  0.015 1.28   2 2.7   3.9 4.3 4000</span>
<span class="co">#&gt; [3] 3.02 0.99  0.76  1.059 2.35   3 3.7   5.0 5.2 4000</span>
<span class="co">#&gt; [4] 4.02 1.01  1.64  1.983 3.35   4 4.7   5.9 6.3 4000</span>
<span class="co">#&gt; [5] 4.99 0.97  2.77  3.144 4.33   5 5.7   6.9 7.2 4000</span></code></pre></div>
<p>Similarly we can draw from Poisson (<code>rvpois</code>) Gamma, (<code>rvgamma</code>), Binomial (<code>rvbinom</code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvpois.html">rvpois</a></span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="componentwise-summaries">Componentwise summaries<a class="anchor" aria-label="anchor" href="#componentwise-summaries"></a>
</h4>
<p>To extract the means, we use <code>rvmean</code>, the s.d.’s, we use <code>rvsd</code>, the minimum, <code>rvmin</code>, the maximum <code>rvmax</code>, and the quantiles, we use <code>rvquantile</code>. The componentwise medians are also obtained by <code>rvmedian</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvmean.html">rvmean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.98 1.98 3.02 4.02 4.99</span>
<span class="fu"><a href="../reference/rvvar.html">rvsd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.98 1.01 0.99 1.01 0.97</span>
<span class="fu"><a href="../reference/rvquantile.html">rvquantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;        2.5%  25% 50% 75% 97.5%</span>
<span class="co">#&gt; [1,] -0.926 0.31   1 1.7   2.9</span>
<span class="co">#&gt; [2,]  0.015 1.28   2 2.7   3.9</span>
<span class="co">#&gt; [3,]  1.059 2.35   3 3.7   5.0</span>
<span class="co">#&gt; [4,]  1.983 3.35   4 4.7   5.9</span>
<span class="co">#&gt; [5,]  3.144 4.33   5 5.7   6.9</span>
<span class="fu"><a href="../reference/rvquantile.html">rvmedian</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 2 3 4 5</span>
<span class="fu"><a href="../reference/rvmin.html">rvmin</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu"><a href="../reference/rvmax.html">rvmax</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] 24</span></code></pre></div>
<p>For convenience, there is an alias <code>E(...)</code> for <code>rvmean(...)</code> which gives the “expectation” of a random vector.</p>
</div>
<div class="section level4">
<h4 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h4>
<p>Since the random vectors are all represented by simulations, the expectation and all other functions that we compute are just numerical approximations. Generating a “standard normal random variable” with <code>z &lt;- rvnorm(n=1, mean=0, sd=1)</code> will not have an expectation exactly zero. Our main purpose here is to handle simulations, so the answers will be approximate and necessarily involve a simulation error.</p>
</div>
<div class="section level4">
<h4 id="extracting-and-replacing">Extracting and replacing<a class="anchor" aria-label="anchor" href="#extracting-and-replacing"></a>
</h4>
<p>Since rv objects work just like vectors, we can extract and replace components by using the bracket notation. Here we replace the 3rd and 4th components with random variables having (an approximate) binomial distributions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvbinom.html">rvbinom</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]  0.1 0.30  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [2]  0.9 0.31  0    0   1   1   1     1   1 4000</span></code></pre></div>
<p>The “mean” column now shows the estimate of the expectation of the two indicator functions we generated.</p>
</div>
<div class="section level4">
<h4 id="imputing-into-regular-vectors">Imputing into regular vectors<a class="anchor" aria-label="anchor" href="#imputing-into-regular-vectors"></a>
</h4>
<p>To “impute” a random vector in a regular numeric vector, we can either first turn the constant vector into an <code>rv</code> object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rv.html">as.rv</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="va">y</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">y</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]  1.0 0.00  1    1   1   1   1     1   1    1</span>
<span class="co">#&gt; [2]  2.0 0.00  2    2   2   2   2     2   2    1</span>
<span class="co">#&gt; [3]  0.1 0.30  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [4]  0.9 0.31  0    0   1   1   1     1   1 4000</span>
<span class="co">#&gt; [5]  5.0 0.00  5    5   5   5   5     5   5    1</span></code></pre></div>
<p>or, use the special function <code>impute</code> that can handle regular vectors and <code>rv</code> objects:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="fu">impute</span><span class="op">(</span><span class="va">y</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">y</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]  1.0 0.00  1    1   1   1   1     1   1    1</span>
<span class="co">#&gt; [2]  2.0 0.00  2    2   2   2   2     2   2    1</span>
<span class="co">#&gt; [3]  0.1 0.30  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [4]  0.9 0.31  0    0   1   1   1     1   1 4000</span>
<span class="co">#&gt; [5]  5.0 0.00  5    5   5   5   5     5   5    1</span></code></pre></div>
<p>The non-random components appearing as “constants,” or in other words, random variables with point-mass distributions (and therefore having a zero variance).</p>
</div>
<div class="section level4">
<h4 id="summaries-of-functions-of-random-vectors">Summaries of functions of random vectors<a class="anchor" aria-label="anchor" href="#summaries-of-functions-of-random-vectors"></a>
</h4>
<p>Standard numerical functions can be applied directly to random vectors. To find a summary of the distribution of the function <span class="math inline">\(1/(1+\exp(-x_1))\)</span>, we would write,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;     mean   sd   1% 2.5%  25%  50%  75% 97.5%  99% sims</span>
<span class="co">#&gt; [1] 0.69 0.18 0.21 0.28 0.58 0.73 0.84  0.95 0.96 4000</span></code></pre></div>
<p>Or of the function of almost anything we like:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;     mean  sd   1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]    1 1.5 -4.4 -2.9 0.5 1.4   2   2.7 2.9 4000</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="order-statistics">Order statistics<a class="anchor" aria-label="anchor" href="#order-statistics"></a>
</h4>
<p>To simulate the order statistics of a random vector <code>x</code>, we can use <code>sort(x)</code>, <code>min(x)</code>, <code>max(x)</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvpois.html">rvpois</a></span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt;     mean  sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] 0.98 1.0  0    0   0   1   2     3   4 4000</span>
<span class="co">#&gt; [2] 1.98 1.4  0    0   1   2   3     5   6 4000</span>
<span class="co">#&gt; [3] 2.97 1.7  0    0   2   3   4     7   8 4000</span>
<span class="co">#&gt; [4] 3.96 2.0  0    1   3   4   5     8   9 4000</span>
<span class="co">#&gt; [5] 5.03 2.2  1    1   3   5   6    10  11 4000</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] 0.61 0.69  0    0   0   0   1     2   2 4000</span>
<span class="co">#&gt; [2] 1.62 0.91  0    0   1   2   2     3   4 4000</span>
<span class="co">#&gt; [3] 2.72 1.07  1    1   2   3   3     5   5 4000</span>
<span class="co">#&gt; [4] 4.02 1.29  2    2   3   4   5     7   7 4000</span>
<span class="co">#&gt; [5] 5.96 1.83  3    3   5   6   7    10  11 4000</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] 0.61 0.69  0    0   0   0   1     2   2 4000</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;     mean  sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]    6 1.8  3    3   5   6   7    10  11 4000</span></code></pre></div>
<p>Note: the <code>order</code> method is not implemented.</p>
</div>
<div class="section level4">
<h4 id="random-matrices-and-arrays">Random matrices and arrays<a class="anchor" aria-label="anchor" href="#random-matrices-and-arrays"></a>
</h4>
<p><code>rv</code> objects behave like numerical vectors in R; thus you can set their dimension attributes to make them appear as arrays, and also use the matrix multiplication operator. (Note: <code>\%**\%} performs the matrix multiplication, ensuring that  non-rv and</code>rv<code>objects get properly multiplied.  Using</code>%*%` does not work if the<br>
matrix or vector on the left is not an rv object.)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="co"># Some prior probabilities.</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvbinom.html">rvbinom</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="va">p</span><span class="op">)</span> <span class="co"># y is now a rv of length 4.</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span> <span class="co"># Make y into a 2x2 matrix.</span>
<span class="va">y</span>
<span class="co">#&gt;         mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1,1] 0.3435 0.47  0    0   0   0   1     1   1 4000</span>
<span class="co">#&gt; [2,1] 0.1010 0.30  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [1,2] 0.4225 0.49  0    0   0   0   1     1   1 4000</span>
<span class="co">#&gt; [2,2] 0.0065 0.08  0    0   0   0   0     0   0 4000</span>
<span class="va">y</span> <span class="op"><a href="../reference/matmult.html">%**%</a></span> <span class="va">y</span>
<span class="co">#&gt;        mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1,1] 0.385 0.51  0    0   0   0   1     1   2 4000</span>
<span class="co">#&gt; [2,1] 0.032 0.18  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [1,2] 0.147 0.36  0    0   0   0   0     1   1 4000</span>
<span class="co">#&gt; [2,2] 0.048 0.21  0    0   0   0   0     1   1 4000</span></code></pre></div>
<p>The componentwise summary functions such as <code>E</code> (<code>rvmean</code>) and <code>rvsd</code> return the summaries with the correct dimension attribute set:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvmean.html">E</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt;      [,1]   [,2]</span>
<span class="co">#&gt; [1,] 0.34 0.4225</span>
<span class="co">#&gt; [2,] 0.10 0.0065</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="creating-indicator-functions-with-logical-operations">Creating indicator functions with logical operations<a class="anchor" aria-label="anchor" href="#creating-indicator-functions-with-logical-operations"></a>
</h4>
<p>Applying logical operators gives indicators of events. If <code>z</code> is a standard normal random variable the indicator of the event <span class="math inline">\(\{z&gt;1\}\)</span> is given by the statement <code>z&gt;1</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">z</span> <span class="op">&gt;</span> <span class="fl">1</span>
<span class="co">#&gt;     mean   sd 1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] 0.14 0.35  0    0   0   0   0     1   1 4000</span></code></pre></div>
<p>We can also use the convenience function <code>Pr(...)</code> to compute the estimates of the expectation of these indicators:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvmean.html">Pr</a></span><span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.14</span></code></pre></div>
<p>Of course, we can find joint events as well and computer their probabilities similarly. To find the probability that <span class="math inline">\(Z_1&gt;Z_2^2\)</span>, where both <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are independent standard normal, we’d type</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/rvmean.html">Pr</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.28</span></code></pre></div>
<p>We can even compute probabilities of intersections or unions of events,</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvmean.html">Pr</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.022</span>
<span class="fu"><a href="../reference/rvmean.html">Pr</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">|</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="functions-of-several-random-variables">Functions of several random variables<a class="anchor" aria-label="anchor" href="#functions-of-several-random-variables"></a>
</h4>
<p>We can use random vectors, regular vectors, standard elementary functions, logical operations in any combination as we wish.</p>
<p>Example. Let <span class="math inline">\(z_1,z_2\)</span> be standard normal, and let <span class="math inline">\(y_1=\exp(z_1), y_2=y_1\exp(z_2)\)</span>.</p>
<p>Compute the expectation of <span class="math inline">\(x=(y_1-1)\mathrm{1}_{y_1&gt;1}\mathrm{1}_{y_2&gt;1}\)</span> and find the probability <span class="math inline">\(\Pr(x&gt;1)\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>
<span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/rvmean.html">E</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.79</span>
<span class="fu"><a href="../reference/rvmean.html">Pr</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.22</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="posterior-simulations-from-a-classical-regression-model">Posterior simulations from a classical regression model<a class="anchor" aria-label="anchor" href="#posterior-simulations-from-a-classical-regression-model"></a>
</h4>
<p>We can generate posterior simulations from a classical regression model, using the standard assumptions for the priors. For convenience there is a function <code>posterior</code> to do this.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span>
  <span class="co">## Some covariates</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">10</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">y.mean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">2.0</span> <span class="op">*</span> <span class="va">X</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">3.0</span> <span class="op">*</span> <span class="va">X</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">y.mean</span>, sd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="co">## n random numbers</span>
  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, <span class="va">X</span><span class="op">)</span>
  <span class="co">## Regression model fit</span>
  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>, data<span class="op">=</span><span class="va">D</span><span class="op">)</span></code></pre></div>
<p>The Bayesian estimates (posterior distributions) are represented by,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">Post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior.html">posterior</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
  <span class="va">Post</span>
<span class="co">#&gt; $beta</span>
<span class="co">#&gt;            name mean   sd    1%  2.5%  25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1] (Intercept)  1.1 0.80 -0.91 -0.45 0.56 1.0 1.5   2.7 3.1 4000</span>
<span class="co">#&gt; [2]          x1  2.0 0.71  0.19  0.57 1.58 2.0 2.4   3.4 3.8 4000</span>
<span class="co">#&gt; [3]          x2  2.9 0.22  2.33  2.43 2.77 2.9 3.0   3.3 3.4 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sigma</span>
<span class="co">#&gt;     mean   sd   1% 2.5% 25% 50% 75% 97.5% 99% sims</span>
<span class="co">#&gt; [1]  1.7 0.54 0.91 0.97 1.3 1.6 1.9     3 3.5 4000</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="creating-replicated-simulations">Creating replicated simulations<a class="anchor" aria-label="anchor" href="#creating-replicated-simulations"></a>
</h4>
<p>Continuing the previous example, we’ll resample from the sampling distribution of <span class="math inline">\(y\)</span> using the posterior simulations we got. We can use the function <code>rvnorm</code> to do this, since it accepts <em>random vectors as arguments</em>. Rather than think <code>rvnorm</code> to draw normal random vectors, it rather “samples from the normal model.” The vector will be normal <em>given</em> (constant) mean and s.d., but if the mean and s.d. are not constants, the resulting vector will not be normal.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">Post</span><span class="op">$</span><span class="va">sigma</span>
<span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">Post</span><span class="op">$</span><span class="va">beta</span>
<span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="va">y.rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span>mean<span class="op">=</span><span class="va">M</span> <span class="op"><a href="../reference/matmult.html">%**%</a></span> <span class="va">betas</span>, sd<span class="op">=</span><span class="va">sigma</span><span class="op">)</span>
<span class="fu"><a href="../reference/mlplot.html">mlplot</a></span><span class="op">(</span><span class="va">y.rep</span><span class="op">)</span> <span class="co"># Summarize graphically.</span></code></pre></div>
<p><img src="rv-doc_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;"> Note also that <code>sigma</code> is also an rv object.</p>
<p>The matrix multiplication statement returns a random vector of length :</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op"><a href="../reference/matmult.html">%**%</a></span> <span class="va">betas</span>
<span class="co">#&gt;      name  mean   sd   1% 2.5%  25%  50%   75% 97.5%   99% sims</span>
<span class="co">#&gt;  [1]    1  9.14 0.74  7.2  7.6  8.7  9.1  9.58 10.65 11.07 4000</span>
<span class="co">#&gt;  [2]    2 -2.95 1.24 -6.1 -5.4 -3.7 -3.0 -2.20 -0.41  0.18 4000</span>
<span class="co">#&gt;  [3]    3 -0.41 1.19 -3.3 -2.7 -1.1 -0.4  0.27  2.05  2.61 4000</span>
<span class="co">#&gt;  [4]    4 -1.34 1.00 -3.7 -3.3 -1.9 -1.3 -0.76  0.76  1.20 4000</span>
<span class="co">#&gt;  [5]    5  7.99 0.56  6.6  6.9  7.6  8.0  8.33  9.14  9.41 4000</span>
<span class="co">#&gt;  [6]    6  8.49 0.62  6.9  7.3  8.1  8.5  8.86  9.76 10.12 4000</span>
<span class="co">#&gt;  [7]    7 14.06 1.01 11.4 12.0 13.5 14.1 14.67 16.10 16.58 4000</span>
<span class="co">#&gt;  [8]    8 -1.63 0.91 -3.8 -3.4 -2.2 -1.6 -1.08  0.24  0.76 4000</span>
<span class="co">#&gt;  [9]    9  8.53 0.63  7.0  7.3  8.2  8.5  8.91  9.82 10.18 4000</span>
<span class="co">#&gt; [10]   10 22.25 1.33 18.7 19.4 21.5 22.3 23.05 24.90 25.40 4000</span></code></pre></div>
<p>Thus all the uncertainty in the mean estimate <span class="math inline">\(X\beta\)</span> and the residual s.d. estimate <span class="math inline">\(\sigma\)</span> is propagated when the replicated vector <span class="math inline">\(y^\mathrm{rep}\)</span> is generated. In effect, this single line of code thus will in fact draw from the distribution <span class="math inline">\(p({y}^\mathrm{rep}|y)=\int\int \mathrm{Normal}({y}^\mathrm{rep}|\mu,\sigma)p(\mu,\sigma|y)\mathrm{d}\mu\mathrm{d}\sigma.\)</span></p>
<p>For convenience, there is a generic method <code>rvpredict</code> to generate replications and predictions:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co">## Replications</span>
  <span class="va">y.rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvpredict.html">rvpredict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p>We can also generate predictions at some other covariate values:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co">## Predictions at the mean of the covariates</span>
  <span class="va">X.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>, x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvpredict.html">rvpredict</a></span><span class="op">(</span><span class="va">fit</span>, newdata<span class="op">=</span><span class="va">X.pred</span><span class="op">)</span></code></pre></div>
<p>We can also perturb (add uncertainty to) the covariate `x1}, then predict again.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">X.rep</span> <span class="op">&lt;-</span> <span class="va">X</span>
  <span class="va">X.rep</span><span class="op">$</span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">X.rep</span><span class="op">$</span><span class="va">x1</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">X.rep</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y.pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvpredict.html">rvpredict</a></span><span class="op">(</span><span class="va">fit</span>, newdata<span class="op">=</span><span class="va">X.rep</span><span class="op">)</span>
  <span class="va">y.pred2</span>
<span class="co">#&gt;        mean  sd    1% 2.5%    25%    50%  75% 97.5%  99% sims</span>
<span class="co">#&gt;  [1] 13.143 2.1   8.1  8.9 11.833 13.134 14.4 17.56 18.7 4000</span>
<span class="co">#&gt;  [2] -2.326 2.0  -7.5 -6.3 -3.556 -2.333 -1.1  1.65  2.6 4000</span>
<span class="co">#&gt;  [3]  1.479 2.4  -4.5 -3.4  0.024  1.508  3.0  6.05  7.1 4000</span>
<span class="co">#&gt;  [4]  0.053 2.1  -5.3 -4.4 -1.213  0.037  1.4  4.34  5.3 4000</span>
<span class="co">#&gt;  [5]  9.236 2.0   4.3  5.3  8.095  9.214 10.4 13.13 14.3 4000</span>
<span class="co">#&gt;  [6]  7.907 1.8   3.4  4.2  6.778  7.895  9.0 11.70 12.5 4000</span>
<span class="co">#&gt;  [7] 12.812 2.2   7.3  8.4 11.506 12.850 14.1 16.95 18.0 4000</span>
<span class="co">#&gt;  [8] -4.792 2.6 -11.1 -9.8 -6.347 -4.801 -3.3  0.39  1.9 4000</span>
<span class="co">#&gt;  [9]  7.426 1.9   2.4  3.6  6.296  7.472  8.6 10.93 12.0 4000</span>
<span class="co">#&gt; [10] 20.114 2.2  14.5 15.8 18.832 20.110 21.4 24.62 25.9 4000</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="graphical-summaries">Graphical summaries}<a class="anchor" aria-label="anchor" href="#graphical-summaries"></a>
</h4>
<p>Graphical summaries are still in development, but it is now possible to plot a scatterplot with a regular vector against a random vector, showing the 50% and 95% <em>uncertainty intervals</em> along with the median, using <code>plot(y,x,...)}, where</code>y<code>is not random but</code>x<code>is. or we can show two random scalars plotted as a 2-dimensional scatterplot with</code>plot(x[1],x[2],…)}.</p>
<p>To illustrate, let us plot the predicted intervals of the previous example, along with the data points.</p>
<p>Plot the predictions against <code>y</code> in red color; then plot the perturbed predictions with blue color.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co">## Plot predictions</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y.rep</span>, y <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">y</span>, rvcol<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y.pred2</span>, <span class="va">D</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.33</span>, rvcol<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="rv-doc_files/figure-html/unnamed-chunk-28-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that the function method needs to be called explicitly to be able to plot constants vs. rv objects. If the first argument of <code>plot(x, ...)</code> is an rv object, one can call <code>plot</code></p>
<p>Or, we can show a random vectors as horizontal intervals using <code>mlplot</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="../reference/mlplot.html">mlplot</a></span><span class="op">(</span><span class="va">y.rep</span>, rvcol<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
  <span class="fu"><a href="../reference/mlplot.html">mlplot</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">y</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span>, pch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></code></pre></div>
<p><img src="rv-doc_files/figure-html/unnamed-chunk-29-1.png" width="480" style="display: block; margin: auto;"></p>
<p>A histogram of the simulations of a random scalar <code>x[1]}, can be plotted with</code>rvhist}:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rvhist.html">rvhist</a></span><span class="op">(</span><span class="fu"><a href="../reference/rvnorm.html">rvnorm</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, 
  col<span class="op">=</span><span class="st">"red"</span>, main<span class="op">=</span><span class="st">"Cubed standard normal"</span><span class="op">)</span></code></pre></div>
<p><img src="rv-doc_files/figure-html/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="example-simulating-polyas-urn">Example: Simulating P'olya’s Urn<a class="anchor" aria-label="anchor" href="#example-simulating-polyas-urn"></a>
</h4>
<p>This code simulates 200 iterations of the well-known P'olya’s urn problem. The parameter <code>x/(n+1)</code> for the Bernoulli-variate-generating function <code>rvbern(...)</code> is random: we can generate random variables using random parameters without much trickery; our code looks therefore more natural.</p>
<p>The model: <span class="math display">\[\begin{eqnarray}
  \quad X_0 &amp;= 1 \\
  \quad X_n-X_{n-1}|X_{n-1} &amp;\sim \text{Bernoulli}( X_{n-1}/(n+1) )
\end{eqnarray}\]</span></p>
<p>The R code:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="../reference/rvbern.html">rvbern</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="../reference/rvhist.html">rvhist</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Histogram</span></code></pre></div>
<p><img src="rv-doc_files/figure-html/unnamed-chunk-32-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can see that the distribution is close to uniform, which is the limiting distribution in this case.</p>
</div>
</div>
<div class="section level2">
<h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h2>
<div class="section level4">
<h4 id="obtaining-the-simulation-matrix">Obtaining the simulation matrix<a class="anchor" aria-label="anchor" href="#obtaining-the-simulation-matrix"></a>
</h4>
<p>To extract the simulation matrix embedded in an rv object, use <code>sims</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sims.html">sims</a></span><span class="op">(</span><span class="va">y.rep</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>
<span class="co">#&gt; [1] 4000   10</span></code></pre></div>
<p>It is our convention to have the columns represent the random vector and the rows represent the draws from the joint distribution of the vector.</p>
</div>
<div class="section level4">
<h4 id="converting-matrices-and-vectors-of-simulations-to-rv-objects">Converting matrices and vectors of simulations to rv objects<a class="anchor" aria-label="anchor" href="#converting-matrices-and-vectors-of-simulations-to-rv-objects"></a>
</h4>
<p>A matrix or a vector of simulations is converted into an rv object by <code>rvsims</code>. Continuing the above example, we’ll convert the matrix back to an rv object.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvsims.html">rvsims</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<p>You can verify that <code>all(sims(y)==s)</code> returns . % TRUE Also note that <code>length(y)</code> gives , since <code>y</code> is “just a vector.”</p>
</div>
<div class="section level4">
<h4 id="coercing-vectors-and-matrices">Coercing vectors and matrices<a class="anchor" aria-label="anchor" href="#coercing-vectors-and-matrices"></a>
</h4>
<p>The function <code>as.rv(x)</code> coerces objects to rv objects. However, this does not mean that matrices of simulations are turned into rv objects—this is done with <code>rvsims</code>, as explained above. <code>as.rv(rnorm(4000))</code> would return a random vector of length 4000, where each component has zero variance (and one single simulation). You probably mean <code>rvsims(rnorm(4000))</code>, but the correct way to generate this object is <code>rvnorm(1)</code>.</p>
</div>
<div class="section level4">
<h4 id="obtaining-simulations-from-r2winbugs">Obtaining simulations from R2WinBUGS<a class="anchor" aria-label="anchor" href="#obtaining-simulations-from-r2winbugs"></a>
</h4>
<p>R2WinBUGS <span class="citation">(Sturtz, Ligges, and Gelman 2005)</span> is an interface for calling WinBUGS within R, and obtaining the simulations as an R matrix (that is embedded in a “<code>bugs</code>” object). If <code>bugsobj</code> is the bugs object returned by the <code>bugs(...)</code> function call, then <code>as.rv</code> will coerce it into a list of random vectors, split by the parameter names: <code>y &lt;- as.rv(bugsobj)</code></p>
</div>
<div class="section level4">
<h4 id="obtaining-simulations-from-umacs">Obtaining simulations from Umacs<a class="anchor" aria-label="anchor" href="#obtaining-simulations-from-umacs"></a>
</h4>
<p>Umacs facilitates the construction of a Gibbs/Metropolis sampler in R , and returns the simulations wrapped in an “<code>UmacsRun</code>” object. Again, the coercion method <code>as.rv</code> will convert the Umacs object, say <code>obj</code>, into a list of named random vectors: <code>y &lt;- as.rv(obj)</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="some-implementation-details">Some implementation details<a class="anchor" aria-label="anchor" href="#some-implementation-details"></a>
</h2>
<p><code>rv</code> is written in “S3” style object-oriented R rather than using the <code>methods</code> (“S4”) package. The main reason was speed, the secondary consideration was the ease of writing new functions.</p>
<p>The main class is called <code>rv</code>. Most functions expecting an rv object have names starting with <code>rv</code>. For example, <code>rvnorm</code>, <code>rvmean</code>, etc.</p>
<p>The package also features rv-specific methods extending the basic numeric vector classes, e.g. <code>c.rv</code>, <code>plot.rv</code>, etc. However, the method dispatch in R will not call the <code>rv</code> class method if the first object in the argument list is not an <code>rv</code> object; for example, <code>c(...)</code> will not call <code>c.rv</code> in the following case: suppose that <code>x</code> is an object of class <code>rv</code> and <code>k &lt;- 10</code>. Then <code>c(k, x)</code> will not call <code>c.rv</code>. To ensure the proper result, wrap the first element in <code>as.rv</code>:</p>
<p><code>c(as.rv(k), x)</code> will produce a proper random vector.</p>
</div>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>This program is a work in progress, and it may contain bugs. Many new features will be eventually (and hopefully) added.</p>
<p>For information about random variables in R, please refer to <span class="citation">Kerman and Gelman (2007)</span>. For information about Umacs (Universal Markov chain sampler) please refer to <span class="citation">Kerman (2005)</span>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-kerman_2006">
<p>Kerman, Jouni. 2005. “Umacs A Universal Markov Chain Sampler.”</p>
</div>
<div id="ref-kerman_gelman_2007">
<p>Kerman, Jouni, and Andrew Gelman. 2007. “Manipulating and Summarizing Posterior Simulations Using Random Variable Objects.” <em>Statistics and Computing</em> 17 (3): 235–44.</p>
</div>
<div id="ref-sturtz_2005">
<p>Sturtz, Sibylle, Uwe Ligges, and Andew Gelman. 2005. “R2WinBUGS A Package for Running WinBUGS from R.” <em>Journal of Statistical Software</em> 12 (3): 1–16.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jouni Kerman, Jemma Stachelek.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
